<!DOCTYPE html>
<html>
<head>
    <title>Shaka Player</title>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/2.5.6/shaka-player.compiled.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/analytics/web/2/bitmovinanalytics.min.js"></script>
    <script type="text/javascript">
      const initPlayer = () => {
        const keyValues = window.location.search.substr(1).split('&')
        let experimentId, mode, alk, mpdURL
        keyValues.forEach(keyValueString => {
          let keyValueArray = keyValueString.split('=')
          switch (keyValueArray[0]) {
            case 'id':
              experimentId = keyValueArray[1]
              break
            case 'mode':
              mode = keyValueArray[1]
              break
            case 'alk':
              alk = keyValueArray[1]
              break
            case 'mpdURL':
              mpdURL = keyValueArray[1]
              break
          }
        })

        const video = document.getElementById('video')
        const player = new shaka.Player(video)
        window.player = player
        player.addEventListener('error', onErrorEvent)
        player.load(mpdURL).then(function () {
          new bitmovin.analytics.adapters.ShakaAdapter({
              key: alk,
              videoId: 'ppt-test',
              title: 'BigBuckBunny_6s_simple_2014_05_09',
              cdnProvider: 'S3',
              experimentName: experimentId,
              debug: mode
            },
            player)
        }).catch(onError)
      }

      const onErrorEvent = (event) => {
        onError(event.detail)
      }

      const onError = (error) => {
        console.error('Error code', error.code, 'object', error)
      }

      document.addEventListener('DOMContentLoaded', () => {
        shaka.polyfill.installAll()

        if (shaka.Player.isBrowserSupported()) {
          initPlayer()
        } else {
          console.error('Browser not supported!')
        }
      })
    </script>
</head>
<body>
<video id="video" width="640" autoplay controls></video>
</body>
</html>
