<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bitmovin Player</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/analytics/web/2/bitmovinanalytics.min.js"></script>
</head>
<body>
<div id="player"></div>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
        const keyValues = window.location.search.substr(1).split('&');
        let experimentId, mode, alk, mpdURL;
        keyValues.forEach(keyValueString => {
            let keyValueArray = keyValueString.split('=');
            switch (keyValueArray[0]) {
                case 'id':
                    experimentId = keyValueArray[1];
                    break;
                case 'mode':
                    mode = keyValueArray[1];
                    break;
                case 'alk':
                    alk = keyValueArray[1];
                    break;
                case 'mpdURL':
                    mpdURL = keyValueArray[1];
                    break;
            }
        });

        experimentId = "qwedwe"
        mode = "debug"
        alk = "a014a94a-489a-4abf-813f-f47303c3912a"
        mpdURL = "https://ppt-input.s3.eu-central-1.amazonaws.com/6sec/BigBuckBunny_6s_simple_2014_05_09.mpd"

        let qualityUp = 0;
        let qualityDown = 0;
        let startupBitrate = 0;
        const config = {
            key: '017bea3e-68e0-4aaf-a5ee-c00e6856ac3b',
            analytics: {
                key: alk,
                videoId: "ppt-test",
                title: "BigBuckBunny_6s_simple_2014_05_09",
                cdnProvider: "S3",
                experimentName: experimentId,
                debug: false
            },
            playback: {
                autoplay: true,
                muted: false
            },
            style: {
                width: '640px',
                height: '360px',
                controls: true
            },
            events: {
                videodownloadqualitychange: (event) => {
                    if (event.sourceQuality) {
                        if (event.targetQuality.bitrate > event.sourceQuality.bitrate) {
                            qualityUp++
                        } else {
                            qualityDown++
                        }
                    }else{
                        startupBitrate = event.targetQuality.bitrate
                    }
                },

                play: (e) => {
                    initTime = new Date().getTime();
                    console.log("PLAY --->", initTime);
                },

                stallstarted: (e) => {
                    console.log("STALL --->", initTime);
                }
            }
        };

        bitmovin.player.Player.addModule(bitmovin.analytics.PlayerModule);
        const player = new bitmovin.player.Player(document.getElementById('player'), config);

        player.load({
            dash: mpdURL,
        }).then(() => {
            console.log('Loaded!')
        }).catch((reason) => {
            console.error('player setup failed', reason);
        });
    });

</script>

</body>
</html>